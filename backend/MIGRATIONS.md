# Миграции базы данных

## Список миграций

### 1. `9df145c80914_fix_enum_types_use_strings.py`
- Исправление типов enum для использования строк
- Базовая миграция для настройки схемы

### 2. `b305c08d9155_add_passport_complete_fields.py`
- Добавление полей для паспортов
- Расширение функциональности паспортной системы

### 3. `26a996733fe0_make_user_id_nullable_in_logs.py` ✨ **НОВАЯ**
- Сделать поле `user_id` в таблице `logs` nullable
- Позволяет логировать анонимные события безопасности
- Исправляет ошибку foreign key constraint при входе без ролей

## Применение миграций

Для применения всех миграций в Docker контейнере:
```bash
docker exec rp_backend alembic upgrade head
```

Для отката последней миграции:
```bash
docker exec rp_backend alembic downgrade -1
```

## Важные изменения

### Миграция 26a996733fe0
- **Что изменилось**: `logs.user_id` теперь может быть NULL
- **Зачем**: Для логирования анонимных событий (неудачные попытки входа)
- **Влияние**: Теперь система может логировать события без привязки к пользователю

### Безопасность
- Все изменения связаны с улучшением системы аутентификации
- Пользователи без необходимых ролей теперь не могут войти в систему
- Все попытки входа логируются для аудита безопасности